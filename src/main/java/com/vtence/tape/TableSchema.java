package com.vtence.tape;

import java.math.BigDecimal;
import java.sql.Date;
import java.sql.Time;
import java.util.ArrayList;
import java.util.List;
import java.util.TimeZone;

public class TableSchema {

    private final String name;
    private final List<Column<?>> columns = new ArrayList<>();

    public TableSchema(String name) {
        this.name = name;
    }

    public String name() {
        return name;
    }

    public Column<Long> LONG(String name) {
        return add(new Column<>(this, name, Types.LONG));
    }

    public Column<String> STRING(String name) {
        return add(new Column<>(this, name, Types.STRING));
    }

    public Column<BigDecimal> BIG_DECIMAL(String name) {
        return add(new Column<>(this, name, Types.BIG_DECIMAL));
    }

    public Column<Integer> INT(String name) {
        return add(new Column<>(this, name, Types.INT));
    }

    public Column<Date> DATE(String name) {
        return DATE(name, TimeZone.getDefault());
    }

    public Column<Date> DATE(String name, TimeZone timeZone) {
        return add(new Column<>(this, name, Types.dateIn(timeZone)));
    }

    public Column<Time> TIME(String name) {
        return TIME(name, TimeZone.getDefault());
    }

    public Column<Time> TIME(String name, TimeZone timeZone) {
        return add(new Column<>(this, name, Types.timeIn(timeZone)));
    }

    public <T> Column<T> add(Column<T> column) {
        columns.add(column);
        return column;
    }

    public int columnCount(boolean includeAutoGenerated) {
        return columns(includeAutoGenerated).size();
    }

    public List<Column<?>> columns(boolean includeAutoGenerated) {
        List<Column<?>> columns = new ArrayList<>();
        for (Column<?> column : this.columns) {
            if (includeAutoGenerated || !column.isAutoGenerated()) columns.add(column);
        }
        return columns;
    }

    public int indexOf(Column<?> column, boolean includeAutoGenerated) {
        return columns(includeAutoGenerated).indexOf(column);
    }
}
